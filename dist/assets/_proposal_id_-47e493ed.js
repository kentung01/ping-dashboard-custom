import{d as rt,i as T,J as ut,Z as ct,a2 as dt,Y as _t,k as vt,ah as mt,a1 as d,a8 as pt,o as _,l as v,n as e,t as o,M as $,q as r,m as w,I as E,F as Y,p as H,ai as ht,z as ft,Q as A,L as bt}from"./index-b40d15d5.js";import{b as gt,W as yt}from"./index-964ff61f.js";import{_ as M}from"./Countdown.vue_vue_type_style_index_0_lang-3df4da2a.js";import{_ as xt}from"./PaginationBar.vue_vue_type_script_setup_true_lang-2495dc49.js";import"./browser-98a7cb58.js";import"./index-4ef61116.js";const Ot={class:"bg-base-100 px-4 pt-3 pb-4 rounded mb-4 shadow"},St={class:"card-title flex flex-col md:!justify-between md:!flex-row mb-2"},Pt={class:"truncate w-full"},Tt={class:""},wt={key:0},Nt={class:"gap-4 mb-4 grid lg:!!grid-cols-3 auto-rows-max"},kt={class:"bg-base-100 px-4 pt-3 pb-4 rounded shadow"},Dt={class:"card-title mb-1"},$t={class:"block text-sm mb-1"},Et={class:"h-5 w-full relative"},At={class:"absolute inset-x-0 inset-y-0 text-center text-sm text-[#666] dark:text-[#eee] flex items-center justify-center"},It={class:"mt-6 grid grid-cols-2"},Vt={class:"bg-base-100 px-4 pt-3 pb-5 rounded shadow lg:!!col-span-2"},Ct={class:"card-title"},Lt={class:"px-1"},Rt={class:"flex items-center mb-4 mt-2"},Ut=e("div",{class:"w-2 h-2 rounded-full bg-error mr-3"},null,-1),Bt={class:"text-base flex-1 text-main"},Wt={class:"text-sm"},Ft={class:"flex items-center mb-4"},zt=e("div",{class:"w-2 h-2 rounded-full bg-primary mr-3"},null,-1),jt={class:"text-base flex-1 text-main"},qt={class:"text-sm"},Gt={class:"mb-4"},Jt={class:"flex items-center"},Yt=e("div",{class:"w-2 h-2 rounded-full bg-yes mr-3"},null,-1),Ht={class:"text-base flex-1 text-main"},Mt={class:"text-sm"},Qt={class:"pl-5 text-sm mt-2"},Zt={class:"flex items-center mb-1"},Kt=e("div",{class:"w-2 h-2 rounded-full bg-success mr-3"},null,-1),Xt={class:"text-base flex-1 text-main"},te={class:"text-sm"},ee={class:"pl-5 text-sm"},se={key:0,class:"mt-4"},ae={class:"flex items-center"},oe=e("div",{class:"w-2 h-2 rounded-full bg-warning mr-3"},null,-1),ne={class:"text-base flex-1 text-main"},le={key:0},ie={key:1},re={class:"text-sm"},ue={class:"pl-5 text-sm mt-2"},ce={class:"bg-base-100 px-4 pt-3 pb-4 rounded mb-4 shadow"},de={class:"card-title"},_e={class:"overflow-x-auto"},ve={class:"table w-full table-zebra"},me={class:"py-2 text-sm"},pe={key:1,class:"py-2 text-sm"},Oe=rt({__name:"[proposal_id]",props:["proposal_id","chain"],setup(N){const g=N,s=T({}),u=ut(),y=ct(),U=dt(),B=_t(),x=vt();y.fetchProposal(g.proposal_id).then(t=>{var c,p,f,b;let a=mt(t.proposal);((c=t.proposal)==null?void 0:c.status)==="PROPOSAL_STATUS_VOTING_PERIOD"&&y.fetchTally(g.proposal_id).then(n=>{a.final_tally_result=n==null?void 0:n.tally}),s.value=a,(p=a.content)!=null&&p.changes&&((f=a.content)==null||f.changes.forEach(n=>{x.rpc.getParams(n.subspace,n.key).then(h=>{s.value.content&&h.param&&(s.value.content.current?s.value.content.current.push(h.param):s.value.content.current=[h.param])})}));const l=((b=a.content)==null?void 0:b["@type"])||"";l.endsWith("MsgUpdateParams")&&(l.indexOf("staking")>-1?x.rpc.getStakingParams().then(n=>{k(n)}):l.indexOf("gov")>-1?x.rpc.getGovParamsVoting().then(n=>{k(n)}):l.indexOf("distribution")>-1?x.rpc.getDistributionParams().then(n=>{k(n)}):l.indexOf("slashing")>-1&&x.rpc.getSlashingParams().then(n=>{k(n)}))});function k(t){var a;s.value.content&&t.params&&(s.value.content.params=[(a=s.value.content)==null?void 0:a.params],s.value.content.current=[t.params])}const W=d(()=>s.value.status==="PROPOSAL_STATUS_PASSED"?"success":s.value.status==="PROPOSAL_STATUS_REJECTED"?"error":""),Q=d(()=>s.value.status?s.value.status.replace("PROPOSAL_STATUS_",""):""),Z=T({});y.fetchProposalDeposits(g.proposal_id).then(t=>Z.value=t);const I=T({}),V=T(new pt),C=T({});y.fetchProposalVotes(g.proposal_id).then(t=>{I.value=t.votes,C.value=t.pagination});function O(t){return t?u.toDay(t,"from"):""}const K=d(()=>{const t=new Date;return new Date(s.value.voting_end_time).getTime()-t.getTime()}),X=d(()=>{var c,p,f,b,n,h,S;const t=Number(((p=(c=s.value.content)==null?void 0:c.plan)==null?void 0:p.height)||0);if(t>0){const P=bt(),D=Number(((n=(b=(f=P.latest)==null?void 0:f.block)==null?void 0:b.header)==null?void 0:n.height)||0);return(t-D)*Number((P.blocktime/1e3).toFixed())*1e3}const a=new Date;return new Date(((S=(h=s.value.content)==null?void 0:h.plan)==null?void 0:S.time)||"").getTime()-a.getTime()}),m=d(()=>{const t=s.value.final_tally_result;let a=0;return t&&(a+=Number(t.abstain||0),a+=Number(t.yes||0),a+=Number(t.no||0),a+=Number(t.no_with_veto||0)),a}),tt=d(()=>{var t;if(m.value>0){const a=((t=B.pool)==null?void 0:t.bonded_tokens)||"1";return u.percent(m.value/Number(a))}return 0}),et=d(()=>{var t,a;if(m.value>0){const l=((a=(t=s.value)==null?void 0:t.final_tally_result)==null?void 0:a.yes)||0;return u.percent(Number(l)/m.value)}return 0}),st=d(()=>{var t,a;if(m.value>0){const l=((a=(t=s.value)==null?void 0:t.final_tally_result)==null?void 0:a.no)||0;return u.percent(Number(l)/m.value)}return 0}),at=d(()=>{var t,a;if(m.value>0){const l=((a=(t=s.value)==null?void 0:t.final_tally_result)==null?void 0:a.no_with_veto)||0;return u.percent(Number(l)/m.value)}return 0}),ot=d(()=>{var t,a;if(m.value>0){const l=((a=(t=s.value)==null?void 0:t.final_tally_result)==null?void 0:a.abstain)||0;return u.percent(Number(l)/m.value)}return 0}),nt=d(()=>[{name:"Turnout",value:tt.value,class:"bg-info"},{name:"Yes",value:et.value,class:"bg-success"},{name:"No",value:st.value,class:"bg-error"},{name:"No With Veto",value:at.value,class:"bg-red-800"},{name:"Abstain",value:ot.value,class:"bg-warning"}]);function lt(t){try{const{data:a}=A.fromBech32(t),l=A.toHex(a),c=B.validators.find(p=>A.toHex(A.fromBech32(p.operator_address).data)===l);return c?c.description.moniker:t}catch{return t}}function it(t){V.value.setPage(t),y.fetchProposalVotes(g.proposal_id,V.value).then(a=>{I.value=a.votes,C.value=a.pagination})}function L(t){if(t){if(t.startsWith("{")&&t.endsWith("}"))return JSON.parse(t)}else return{title:"",summary:""};return{title:t,summary:""}}return(t,a)=>{var l,c,p,f,b,n,h,S,P,D,F,z,j,q,G;return _(),v("div",null,[e("div",Ot,[e("h2",St,[e("p",Pt,o(N.proposal_id)+". "+o(s.value.title||((l=s.value.content)==null?void 0:l.title)||((p=L((c=s.value)==null?void 0:c.metadata))==null?void 0:p.title)),1),e("div",{class:$(["badge badge-ghost",r(W)==="success"?"text-yes":r(W)==="error"?"text-no":"text-info"])},o(r(Q)),3)]),e("div",Tt,[w(gt,{value:s.value.content},null,8,["value"])]),s.value.summary&&!((f=s.value.content)!=null&&f.description)||(n=L((b=s.value)==null?void 0:b.metadata))!=null&&n.summary?(_(),v("div",wt,[w(r(yt),{"model-value":r(u).multiLine(s.value.summary||((S=L((h=s.value)==null?void 0:h.metadata))==null?void 0:S.summary)),previewOnly:"",class:"md-editor-recover"},null,8,["model-value"])])):E("",!0)]),e("div",Nt,[e("div",kt,[e("h2",Dt,o(t.$t("gov.tally")),1),(_(!0),v(Y,null,H(r(nt),(i,R)=>(_(),v("div",{class:"mb-1",key:R},[e("label",$t,o(i.name),1),e("div",Et,[e("div",{class:$(["absolute inset-x-0 inset-y-0 w-full opacity-10 rounded-sm",`${i.class}`])},null,2),e("div",{class:$(["absolute inset-x-0 inset-y-0 rounded-sm",`${i.class}`]),style:ht(`width: ${i.value==="-"||i.value==="NaN%"?"0%":i.value}`)},null,6),e("p",At,o(i.value),1)])]))),128)),e("div",It,[e("label",{for:"vote",class:"btn btn-primary float-right btn-sm mx-1",onClick:a[0]||(a[0]=i=>r(U).open("vote",{proposal_id:N.proposal_id}))},o(t.$t("gov.btn_vote")),1),e("label",{for:"deposit",class:"btn btn-primary float-right btn-sm mx-1",onClick:a[1]||(a[1]=i=>r(U).open("deposit",{proposal_id:N.proposal_id}))},o(t.$t("gov.btn_deposit")),1)])]),e("div",Vt,[e("h2",Ct,o(t.$t("gov.timeline")),1),e("div",Lt,[e("div",Rt,[Ut,e("div",Bt,o(t.$t("gov.submit_at"))+": "+o(r(u).toDay(s.value.submit_time)),1),e("div",Wt,o(O(s.value.submit_time)),1)]),e("div",Ft,[zt,e("div",jt,o(t.$t("gov.deposited_at"))+": "+o(r(u).toDay(s.value.status==="PROPOSAL_STATUS_DEPOSIT_PERIOD"?s.value.deposit_end_time:s.value.voting_start_time)),1),e("div",qt,o(O(s.value.status==="PROPOSAL_STATUS_DEPOSIT_PERIOD"?s.value.deposit_end_time:s.value.voting_start_time)),1)]),e("div",Gt,[e("div",Jt,[Yt,e("div",Ht,o(t.$t("gov.vote_start_from"))+" "+o(r(u).toDay(s.value.voting_start_time)),1),e("div",Mt,o(O(s.value.voting_start_time)),1)]),e("div",Qt,[w(M,{time:r(K)},null,8,["time"])])]),e("div",null,[e("div",Zt,[Kt,e("div",Xt,o(t.$t("gov.vote_end"))+" "+o(r(u).toDay(s.value.voting_end_time)),1),e("div",te,o(O(s.value.voting_end_time)),1)]),e("div",ee,o(t.$t("gov.current_status"))+": "+o(t.$t(`gov.proposal_statuses.${s.value.status}`)),1)]),(F=(D=(P=s.value)==null?void 0:P.content)==null?void 0:D["@type"])!=null&&F.endsWith("SoftwareUpgradeProposal")?(_(),v("div",se,[e("div",ae,[oe,e("div",ne,[ft(o(t.$t("gov.upgrade_plan"))+": ",1),Number(((j=(z=s.value.content)==null?void 0:z.plan)==null?void 0:j.height)||"0")>0?(_(),v("span",le," (EST)")):(_(),v("span",ie,o(r(u).toDay((G=(q=s.value.content)==null?void 0:q.plan)==null?void 0:G.time)),1))]),e("div",re,o(O(s.value.voting_end_time)),1)]),e("div",ue,[w(M,{time:r(X)},null,8,["time"])])])):E("",!0)])])]),e("div",ce,[e("h2",de,o(t.$t("gov.votes")),1),e("div",_e,[e("table",ve,[e("tbody",null,[(_(!0),v(Y,null,H(I.value,(i,R)=>(_(),v("tr",{key:R},[e("td",me,o(lt(i.voter)),1),i.option&&i.option!=="VOTE_OPTION_UNSPECIFIED"?(_(),v("td",{key:0,class:$(["py-2 text-sm",{"text-yes":i.option==="VOTE_OPTION_YES","text-gray-400":i.option==="VOTE_OPTION_ABSTAIN"}])},o(String(i.option).replace("VOTE_OPTION_","")),3)):E("",!0),i.options?(_(),v("td",pe,o(i.options.map(J=>`${J.option.replace("VOTE_OPTION_","")}:${r(u).percent(J.weight)}`).join(", ")),1)):E("",!0)]))),128))])]),w(xt,{limit:V.value.limit,total:C.value.total,callback:it},null,8,["limit","total"])])])])}}});export{Oe as default};
