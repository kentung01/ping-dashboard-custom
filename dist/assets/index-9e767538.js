import{d as G,o as l,l as r,F as V,p as I,n as t,M as b,Y as Q,J as Y,L as X,k as Z,i as d,x as A,Q as g,ae as T,j as ee,cG as K,ac as te,r as se,t as a,m as O,O as oe,w as ae,s as ne,z as v,q as x,I as U}from"./index-b40d15d5.js";import{b as W}from"./route-block-83d24a4e.js";const ie={class:"flex gap-0.5"},le=["data-tip"],re=G({__name:"UptimeBar",props:{blocks:{type:Array}},setup(N){return(y,p)=>(l(),r("div",ie,[(l(!0),r(V,null,I(N.blocks,(u,f)=>(l(),r("div",{class:"cursor-default",key:f},[t("div",{class:b(["tooltip",u.color]),"data-tip":u.height,style:{width:"3px"}},"   ",10,le)]))),128))]))}}),ce={class:"tabs tabs-boxed bg-transparent mb-4"},de={class:"tab text-gray-400 capitalize"},ue={class:"bg-base-100 px-5 pt-5"},me={class:"flex items-center gap-x-4"},_e={class:"flex flex-row flex-wrap gap-x-4 mt-4 justify-center"},pe={class:"flex justify-between py-0 w-[248px]"},he={class:"truncate text-sm"},ge={class:"ml-1 text-black dark:text-white"},be={key:0,class:"badge badge-sm bg-transparent border-0 text-red-500 font-bold"},fe={key:1,class:"badge badge-sm bg-transparent text-green-600 border-0 font-bold"},ke={class:"mt-5 text-xs flex justify-center gap-2"},ve={class:"font-bold"},xe=t("span",{class:"bg-green-500"}," ",-1),ye=t("span",{class:"bg-yellow-500"}," ",-1),we=t("span",{class:"bg-red-500"}," ",-1),$e={class:"table table-compact w-full mt-5"},Ce={class:"capitalize bg-base-200"},Ne={class:"text-right"},Be={class:"text-right"},Se={class:"text-right"},ze={class:"hover"},je={class:"truncate max-w-sm"},Le={class:"text-right"},Pe=["data-tip"],Te={key:0},Ve=["data-tip"],Ie={class:"text-xs text-right"},De={key:0,class:"text-right"},Ee={class:"text-right"},Fe={class:"capitalize"},He={colspan:"2",class:"text-right"},Me=["data-tip"],Ae={class:"ml-2 btn btn-error btn-xs"},Ke=t("td",{colspan:"8"},null,-1),Oe=t("div",{class:"h-6"},null,-1),Ue=G({__name:"index",props:["chain"],setup(N){const y=Q(),p=Y(),u=X(),f=Z(),m=d(0),w=d(""),B=d(!0),$=d({}),D=d({}),S=d([]);function R(s=[]){const o=Array(50).fill({height:"0",color:"bg-secondary"}).concat(s);return o.slice(o.length-50)}const z=A(()=>f.isConsumerChain?S.value.map(s=>{var e;const o=K(s.moniker);return{moniker:((e=y.validators.find(i=>g.toBase64(g.fromHex(T(i.consensus_pubkey)))===o))==null?void 0:e.description.moniker)||s.moniker,base64:s.base64}}):y.validators.map(s=>{const o=T(s.consensus_pubkey);return{moniker:s.description.moniker,base64:g.toBase64(g.fromHex(o))}})),j=d({}),E=A(()=>{const s=w.value.length===0?z.value:z.value.filter(n=>n.moniker.toLowerCase().includes(w.value.toLowerCase())),o=Number($.value.signed_blocks_window||0);return s.map(n=>{const e=D.value[n.base64],i=e&&o>0?(o-Number(e.missed_blocks_counter))/o:void 0;return{moniker:n.moniker,base64:n.base64,blocks:R(j.value[n.base64]||[]),uptime:i,missed_blocks_counter:e==null?void 0:e.missed_blocks_counter,signing:e}})}),F=d(!1);u.$subscribe((s,o)=>{var e,i,c;const n=Number(((c=(i=(e=o.latest)==null?void 0:e.block)==null?void 0:i.header)==null?void 0:c.height)||0);if(n>m.value){if(m.value=n,F.value||(q(),F.value=!0),n>0&&S.value.length===0){const _=o.latest.block.header.chain_id;Promise.resolve().then(async()=>{await y.getConsumerValidators(_).then(h=>{h.validators.sort((C,P)=>Number(P.power)-Number(C.power)).forEach(C=>{const P=g.toBase64(g.fromHex(T({"@type":"/cosmos.crypto.ed25519.PubKey",key:C.consumer_key.ed25519}))),J=C.provider_address;S.value.push({moniker:J,base64:P})})})})}Number(o.latest.block.header.height)%7===0&&H(),L(o.latest)}}),ee(()=>{var s;B.value=!0,(s=u.recents)==null||s.forEach(o=>{L(o,"start")}),H(),f.rpc.getSlashingParams().then(o=>{$.value=o.params})});function q(){if(m.value>50&&u.recents.length>=49)return;let s=Promise.resolve();for(let o=m.value-u.recents.length;o>m.value-50&&o>1;o-=1)s=s.then(()=>new Promise(n=>{B.value&&o>m.value-50&&u.fetchBlock(o).then(e=>{L(e,"start"),n()})}))}function L(s,o="end"){z.value.forEach(n=>{var _;const e=(_=s.block.last_commit)==null?void 0:_.signatures.find(h=>h.validator_address===n.base64),i=j.value[n.base64]||[];let c={height:s.block.header.height,color:"bg-red-500"};e&&(c={height:s.block.header.height,color:e.block_id_flag==="BLOCK_ID_FLAG_COMMIT"?"bg-green-500":"bg-yellow-500"}),o==="end"?i.push(c):i.unshift(c),i.length>50&&i.shift(),j.value[n.base64]=i})}function H(){f.rpc.getSlashingSigningInfos().then(s=>{var o;(o=s.info)==null||o.forEach(n=>{D.value[K(n.address)]=n})})}te(()=>{B.value=!1});const k=d("2");function M(s){k.value=s}return(s,o)=>{const n=se("RouterLink");return l(),r("div",null,[t("div",ce,[t("a",{class:b(["tab text-gray-400 capitalize",{"tab-active":k.value==="3"}]),onClick:o[0]||(o[0]=e=>M("3"))},a(s.$t("uptime.overall")),3),t("a",{class:b(["tab text-gray-400 capitalize",{"tab-active":k.value==="2"}]),onClick:o[1]||(o[1]=e=>M("2"))},a(s.$t("module.blocks")),3),O(n,{to:`/${N.chain}/uptime/customize`},{default:oe(()=>[t("a",de,a(s.$t("uptime.customize")),1)]),_:1},8,["to"])]),t("div",ue,[t("div",me,[ae(t("input",{type:"text","onUpdate:modelValue":o[2]||(o[2]=e=>w.value=e),placeholder:"Keywords to filter validators",class:"input input-sm w-full flex-1 border border-gray-200 dark:border-gray-600"},null,512),[[ne,w.value]])]),t("div",{class:b(k.value==="2"?"":"hidden")},[t("div",_e,[(l(!0),r(V,null,I(E.value,(e,i)=>(l(),r("div",{key:i},[t("div",pe,[t("label",he,[t("span",ge,a(i+1)+"."+a(e.moniker),1)]),Number((e==null?void 0:e.missed_blocks_counter)||0)>10?(l(),r("div",be,a(e==null?void 0:e.missed_blocks_counter),1)):(l(),r("div",fe,a(e==null?void 0:e.missed_blocks_counter),1))]),O(re,{blocks:e.blocks},null,8,["blocks"])]))),128))]),t("div",ke,[t("span",ve,a(s.$t("uptime.legend"))+": ",1),xe,v(" "+a(s.$t("uptime.committed"))+" ",1),ye,v(" "+a(s.$t("uptime.precommitted"))+" ",1),we,v(" "+a(s.$t("uptime.missed")),1)])],2),t("div",{class:b([k.value==="3"?"":"hidden","overflow-x-auto"])},[t("table",$e,[t("thead",Ce,[t("tr",null,[t("td",null,a(s.$t("account.validator")),1),t("td",Ne,a(s.$t("module.uptime")),1),t("td",null,a(s.$t("uptime.last_jailed_time")),1),t("td",Be,a(s.$t("uptime.signed_precommits")),1),t("td",Se,a(s.$t("uptime.start_height")),1),t("td",null,a(s.$t("uptime.tombstoned")),1)])]),(l(!0),r(V,null,I(E.value,(e,i)=>{var c,_,h;return l(),r("tr",ze,[t("td",null,[t("div",je,a(i+1)+". "+a(e.moniker),1)]),t("td",Le,[t("span",{class:b(e.uptime&&e.uptime>.95?"text-green-500":"text-red-500")},[t("div",{class:"tooltip","data-tip":`${e.missed_blocks_counter} missing blocks`},a(x(p).percent(e.uptime)),9,Pe)],2)]),t("td",null,[e.signing&&!e.signing.jailed_until.startsWith("1970")?(l(),r("span",Te,[t("div",{class:"tooltip","data-tip":x(p).toDay(e.signing.jailed_until,"long")},[t("span",null,a(x(p).toDay(e.signing.jailed_until,"from")),1)],8,Ve)])):U("",!0)]),t("td",Ie,[e.signing&&e.signing.jailed_until.startsWith("1970")?(l(),r("span",De,a(x(p).percent(Number(e.signing.index_offset)/(m.value-Number(e.signing.start_height)))),1)):U("",!0),v(" "+a((c=e.signing)==null?void 0:c.index_offset),1)]),t("td",Ee,a((_=e.signing)==null?void 0:_.start_height),1),t("td",Fe,a((h=e.signing)==null?void 0:h.tombstoned),1)])}),256)),t("tfoot",null,[t("tr",null,[t("td",He,[v(a(s.$t("uptime.minimum_uptime"))+": ",1),t("span",{class:"lowercase tooltip","data-tip":`Window size: ${$.value.signed_blocks_window}`},[t("span",Ae,a(x(p).percent($.value.min_signed_per_window)),1)],8,Me)]),Ke])])])],2),Oe])])}}});typeof W=="function"&&W(Ue);export{Ue as default};
